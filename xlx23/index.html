<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>A Gift for you</title>
        <style media="screen">
            body {
                font-family: 'Helvetica Neue', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            }
        </style>
        <script src="http://oss.maxcdn.com/jquery/3.0.0-beta1/jquery.min.js" charset="utf-8"></script>
        <script src="http://oss.maxcdn.com/semantic-ui/2.1.8/semantic.min.js" charset="utf-8"></script>
        <link rel="stylesheet" href="http://oss.maxcdn.com/semantic-ui/2.1.8/semantic.min.css" media="screen" title="no title" charset="utf-8">
        <style media="screen">
            .ui.card {
                width: 100%;
            }
            .hideborder td {
                border: 0px !important;
                font-size: 0px !important;
            }
        </style>
    </head>
    <body>
        <div class="ui container">
            <h1 class="ui header">A Gift for you!
                <div class="sub header">ç»™ç†Šç†Šçš„ç”Ÿæ—¥ç¤¼ç‰©</div>
            </h1>
            <div class="ui red stacked compact segment">
                <div id="board" class="">

                </div>


                <div class="ui divider">

                </div>
                <div id="chatroom">

                </div>
            </div>
        </div>
<script type="text/javascript">

round=0;
helptime = 0;
function help() {
    helptime += 1;
    if (helptime == 1) {
        say("æœ‰äº›æ ¼å­çš„å­—è¦ç²—ä¸€äº›å“¦ï¼Œ æ˜¯ä¸æ˜¯è¦è®©æ‰€æœ‰å­—éƒ½å˜ç²—å‘¢ï¼Ÿ<br/>è¦å¸®å¿™å†æ¥æ‰¾æˆ‘å“¦ï½");
    }
    if (helptime == 2) {
        say("æ¯ä¸ªæ ¼å­çš„æ•°å­—ä¼¼ä¹ä»£è¡¨äº†ä»–é™„è¿‘ä¹ä¸ªæ ¼å­åº”è¯¥æœ‰å¤šå°‘ä¸ªæ˜¯çº¢çš„ï¼");
    }
    if (helptime == 3) {
        say("åŠ æ²¹ï½åŠ æ²¹ï½ä½ éœ€è¦è®©æ¯ä¸ªæ ¼å­çš„æ•°å­—éƒ½å˜æˆï¼ï¼");
    }
    if (helptime == 4) {
        //say("<img class='ui big image' src='tips.png' >");
    }
}

function say(s, s1, s2, cb) {
    chatroom = $("#chatroom");
    s = '<big>'+s+'</big>';
    s = '<big>'+s+'</big>';
    s = '<big>'+s+'</big>';
    var dom_str;
    if (cb) {
        dom_str = '<div class="ui green invert card"><div class="content">'+s+
        '</div><div class="extra content"><div class="ui two buttons" style="width:70%">'+
        '<div class="ui basic green button">'+ s1 +'</div><div class="ui basic red button">'+s2+'</div></div>'+
        '<div class="right floated author"><img class="ui massive avatar image" src="avatar.jpg" onclick="help()">å°ç›¾</div></div></div>';
        dom_str = $(dom_str);
        dom_str.find(".green.button").click(function() {$(".button").addClass("disabled"); cb(true)});
        dom_str.find(".red.button").click(function() {$(".button").addClass("disabled"); cb(false)});
    } else
        dom_str = '<div class="ui green invert card"><div class="content">'+s+
        '</div><div class="extra content"><div class="right floated author"><img class="ui massive avatar image" src="avatar.jpg" onclick="help()">å°ç›¾</div></div></div>'
    chatroom.prepend(dom_str);
    chatroom.children().first().transition('bounce');
;
    //setTimeout(function(){say(s+'1');}, 1000);
}

f1 = true;
f2 = true;
f3 = false;
f4 = true;

function restart() {
    for (i=0; i<9; i++)
        for (j=0; j<11; j++) {
            var td = getTd(i*11+j);
            td.bgColor = "#ffffff";
        }
    if (round == 1) {
        f1 = true;
        f2 = false;
        f3 = true;
        f4 = true;
        hint = new Array(0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,1,1,1,1,2,1,2,3,3,4,5,4,3,3,2,4,2,3,5,5,7,8,7,5,5,3,6,3,3,5,5,8,9,8,5,5,3,6,3,3,4,3,6,7,6,3,4,4,7,4,2,2,1,3,4,3,1,2,3,5,3,1,1,0,1,1,1,0,1,2,3,2,
        0,0,0,0,0,0,0,0,0,0,0);
    } else {
        mine = []
        hint = []
        f1 = false;
        f2 = false;
        f3 = false;
        f4 = true;
        for (i=0; i<9; i++)
            for (j=0; j<11; j++) {
                if (Math.random() < 0.37) {
                    mine.push(1);
                } else
                    mine.push(0);
            }
        for (i=0; i<9; i++)
            for (j=0; j<11; j++) {
                var s=0;
                for (ii=i-1;ii<=i+1;ii++)
                    for (jj=j-1;jj<=j+1;jj++)  {
                        if (ii<0 || ii>=9 || jj<0 || jj>=11) continue;
                        s += mine[ii*11+jj];
                    }
                hint.push(s);
            }
    }
    say("æ¸¸æˆé‡æ–°å¼€å§‹å•¦ï¼");
    $("#board").removeClass("hideborder");
    check();
}

function onflip() {
    console.log(now_correct);
    if (now_correct > 10+22 && f1) {
        f1 = false;
        say("å¥½åƒæœ‰æˆï¼");
    }
    if (now_correct > 20+22 && f2) {
        f2 = false;
        say("çŒœçŒœä¼šçœ‹åˆ°ä»€ä¹ˆå‘¢ï¼Ÿ(âœªÏ‰âœª)");
    }
    if (now_correct > 40+22 && f3) {
        f3 = false;
        say("(ï¿£yâ–½ï¿£)~*æ‚å˜´å·ç¬‘");
    }

    if (now_correct >= 77+22 && f4) {
        f4 = false;
        say("ç†Šç†Šå¥½æ£’ï½");
        mytimeout(function() {
            round++;
            if (round == 1) {
                say("è¦ä¸è¦å†ç©ä¸€ç›˜å‘€ï¼Ÿ", "å¥½å‘€", "ä¸äº†", function(yes){
                    if (yes) {
                        restart();
                    } else {
                        say("å†ç©æœ€åä¸€ç›˜å¥½ä¸å¥½ğŸ˜£", "å¥½å§","ä¸ç©", function(yes) {
                            if (yes) {
                                restart();
                            } else {
                                say("å“¦...é‚£ä½ æŠŠçª—å£å…³æ‰å°±å¥½äº†", "å¥½å§ï¼Œç©","å¥½å§ï¼Œç©", function(yes) {
                                    if (yes) {
                                        restart();
                                    } else {
                                        restart();
                                    }
                                })
                            }
                        })
                    }
                })
            } else {
                $("#board").addClass("hideborder");
                say("æˆ‘å–œæ¬¢ä½ ï¼Œè®©æˆ‘åšä½ ç”·æœ‹å‹å¥½ä¸å¥½å˜›ï¼Ÿ", "å¥½çš„", "å¯¹ä¸èµ·ï¼Œä½ æ˜¯ä¸ªå¥½äºº...", function(yes) {
                    if (yes) {
                        say("å¥½è€¶ãƒ½ï¼ˆâœ¿ï¾Ÿâ–½ï¾Ÿï¼‰ãƒï¼Œç›¾ç›¾ä»¥åå°±æ˜¯ä½ çš„å•¦ï¼");
                        mytimeout(function() {
                            say("è¿˜æƒ³å†ç©ä¸€ç›˜å—ï¼Ÿ", "å¥½å‘€", "ä¸ç©äº†", function(yes) {
                                if (yes)
                                    restart();
                                else {
                                    say("é‚£ä½ æŠŠçª—å£å…³æ‰å°±å¥½å•¦ï½");
                                }
                            })
                        }, 2);
                    } else {
                        say("ç”Ÿæ°”ï¼è‡ªæˆ‘é”€æ¯ï¼");
                        mytimeout(function() {
                            $("body").text("");
                        }, 2);
                    }
                });
            }
        }, 2);
    }
}

function mytimeout(a,b) {
    setTimeout(a,b*1000);
}

function main() {
    say("ç†Šç†Šä½ å¥½(ã¥ â—â”€â— )ã¥ <br/> è¿™æ˜¯æˆ‘é€ç»™ä½ çš„ç”Ÿæ—¥ç¤¼ç‰©ã€‚");
    mytimeout(function(){say('æˆ‘æ˜¯ç›¾ç›¾çš„åˆ†èº«å°ç›¾ï¼ŒçŸ¥é“ç†Šç†Šæ˜¯ä¸ªæ‰«é›·é«˜æ‰‹ï¼Œè¿™æ˜¯æˆ‘æœ€è¿‘æ‰¾åˆ°çš„ä¸€ä¸ªè°œé¢˜å“¦ï¼Œäº¤ç»™ä½ å•¦ #ä¸¥è‚ƒè„¸(ã€‚ãƒ»`Ï‰Â´ãƒ»)# ï½<br/>ä½ è¯•ç€æˆ³ä¸€æˆ³è¿™äº›æ–¹å—å“¦')}, 8);
    mytimeout(function(){
        if (f2) say('ç‚¹æˆ‘å¤´åƒæˆ‘æ¥å¸®å¿™å“¦ï½');
    }, 30);
}

fliptime = 0;
function onflipred() {
    fliptime += 1;
    if (fliptime == 1) {
        say("å˜çº¢äº†ï¼")
    }
    if (fliptime == 2) {
        say("åˆçº¢äº†è€¶ï¼")
    }
    if (fliptime == 3) {
        say("åˆ...(ï¿£Îµ(#ï¿£)â˜†â•°â•®o(ï¿£â–½ï¿£///) <br/>å•Šï¼Œ ç†Šç†Šå§æˆ‘é—­å˜´äº†......")
    }
}

$(document).ready(main);

hint = [2,3,2,3,2,2,0,1,2,3,2,3,5,3,5,4,5,2,3,3,5,3,2,3,2,3,3,4,2,2,2,3,2,1,3,3,5,4,5,4,5,3,3,1,0,1,2,4,3,3,2,4,3,2,0,0,2,4,7,5,5,4,7,5,3,0,0,2,3,5,3,3,2,5,4,3,0,0,3,5,7,4,4,4,7,5,3,0,0,2,3,4,2,2,2,4,3,2,0];

function getTd(id)
{
return document.getElementById("td" + id.toString());
}

function init()
{
for (i=0; i<9; i++)
{
    var newTr = document.createElement("tr");
    for (j=0; j<11; j++)
    {
        var newTd = document.createElement("td");
        newTd.style['vertical-align'] = 'middle';
        newTd.style['font-size'] = '20px';
        newTd.id = "td" + (i*11+j).toString();
        newTd.style.border = "1px solid black";
        newTd.style.height = "55px";
        newTd.style.width = "55px";
        newTd.style.cursor = "default";
        newTd.style.textAlign = "center";
        newTd.style.color = "#676767";
        newTd.style.fontWeight = "normal";
        newTd.onclick = function(){flip(this)};
        newTd.bgColor = "#ffffff";
        newTd.innerHTML = hint[i*11+j].toString();
        newTr.appendChild(newTd);
    }
    document.getElementById("board").appendChild(newTr);
}
check();
}

function flip(el)
{
if (el.bgColor == "#ffffff") {
    el.bgColor = "#ff628c";
    onflipred();
}
else
    el.bgColor = "#ffffff";
check();
onflip();
}

now_correct = 2;
tmp = []

function check() {
    var winFlag = true;
    now_correct = 0;
    tmp = []
    for (i=0; i<9; i++)
    {
        for (j=0; j<11; j++)
        {
            var v = matchHint(i*11+j);
            tmp.push(v);
            v = hint[i*11+j] - v;
            $(getTd(i*11+j)).text(v);
            if (v == 0) {
                now_correct += 1;
                getTd(i*11+j).style.color = "black";
                getTd(i*11+j).style.fontWeight = "bold";
            } else {
                getTd(i*11+j).style.color = "#676767";
                getTd(i*11+j).style.fontWeight = "normal";
                winFlag = false;
            }
        }
    }
    if (winFlag)
        ;
    else
        ;
}

function matchHint(id) {
    var toCheck = new Array(1, 1, 1, 1, 1, 1, 1, 1, 1);
    var colorCount = 0;
    if (id < 11) {toCheck[0] = 0; toCheck[1] = 0; toCheck[2] = 0; }
    if (id > 65+22) {toCheck[6] = 0; toCheck[7] = 0; toCheck[8] = 0; }
    if (id % 11 == 0) {toCheck[0] = 0; toCheck[3] = 0; toCheck[6] = 0; }
    if (id % 11 == 10) {toCheck[2] = 0; toCheck[5] = 0; toCheck[8] = 0; }
    if ((toCheck[0] == 1) && (getTd(id-12).bgColor == "#ff628c")) colorCount++;
    if ((toCheck[1] == 1) && (getTd(id-11).bgColor == "#ff628c")) colorCount++;
    if ((toCheck[2] == 1) && (getTd(id-10).bgColor == "#ff628c")) colorCount++;
    if ((toCheck[3] == 1) && (getTd(id-1).bgColor == "#ff628c")) colorCount++;
    if ((toCheck[4] == 1) && (getTd(id).bgColor == "#ff628c")) colorCount++;
    if ((toCheck[5] == 1) && (getTd(id+1).bgColor == "#ff628c")) colorCount++;
    if ((toCheck[6] == 1) && (getTd(id+10).bgColor == "#ff628c")) colorCount++;
    if ((toCheck[7] == 1) && (getTd(id+11).bgColor == "#ff628c")) colorCount++;
    if ((toCheck[8] == 1) && (getTd(id+12).bgColor == "#ff628c")) colorCount++;
    return colorCount;
    return Math.abs(hint[id] - colorCount);
    if (colorCount == hint[id])
        return true;
    else
        return false;
}

init();
</script>
    </body>
</html>
